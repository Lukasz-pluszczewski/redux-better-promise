{"version":3,"file":"library-boilerplate.js","sources":["../src/index.js"],"sourcesContent":["import _ from 'lodash';\n\nconst defaultConfig = {\n  promiseFieldName: 'promise',\n  functionFieldName: 'function',\n  typesFieldName: 'types',\n  hooksFieldName: 'hooks',\n  typesNames: {\n    start: 'start',\n    success: 'success',\n    error: 'error',\n  },\n  hooksNames: {\n    start: 'start',\n    success: 'success',\n    error: 'error',\n  },\n};\n\nexport default function createReduxPromiseMiddleware(additionalData, userConfig) {\n  const config = _.merge({}, defaultConfig, userConfig);\n\n  return ({ getState, dispatch }) => next => action => {\n    // checking if middleware can handle this kind of action\n    if (action[config.promiseFieldName] || action[config.functionFieldName]) {\n      // getting fields from action object according to config\n      const promise = action[config.promiseFieldName];\n\n      const func = action[config.functionFieldName];\n\n      const type = action.type;\n\n      let types;\n      // mapping types to standard object\n      if (action[config.typesFieldName]) {\n        if (Array.isArray(action[config.typesFieldName])) {\n          types = {\n            start: action[config.typesFieldName][0],\n            success: action[config.typesFieldName][1],\n            error: action[config.typesFieldName][2],\n          };\n        } else if (_.isPlainObject(action[config.typesFieldName])) {\n          types = {\n            start: action[config.typesFieldName][config.typesNames.start],\n            success: action[config.typesFieldName][config.typesNames.success],\n            error: action[config.typesFieldName][config.typesNames.error],\n          };\n        } else {\n          throw new Error(`${config.typesFieldName} must be an array or plain object`);\n        }\n      }\n\n      // I'm not sure if it should be an error\n      if (!type && !types) {\n        throw new Error('You must provide type or types field');\n      }\n\n      let hooks;\n      if (action[config.hooksFieldName]) {\n        if (Array.isArray(action[config.hooksFieldName])) {\n          hooks = {\n            start: action[config.hooksFieldName][0],\n            success: action[config.hooksFieldName][1],\n            error: action[config.hooksFieldName][2],\n          };\n        } else if (_.isPlainObject(action[config.hooksFieldName])) {\n          hooks = {\n            start: action[config.hooksFieldName][config.hooksNames.start],\n            success: action[config.hooksFieldName][config.hooksNames.success],\n            error: action[config.hooksFieldName][config.hooksNames.error],\n          };\n        } else {\n          throw new Error(`${config.hooksFieldName} must be an array or plain object`);\n        }\n      }\n\n      const rest = _.omit(\n        action,\n        [config.promiseFieldName, config.functionFieldName, config.typesFieldName, config.hooksFieldName, 'type']\n      );\n\n      if (types && types.start) {\n        next({ type: types.start, ...rest });\n      }\n      if (hooks && hooks.start) {\n        hooks.start(rest);\n      }\n\n      if (promise) {\n        if (typeof promise !== 'function') {\n          throw new Error(`${config.promiseFieldName} must be a function returning promise`);\n        }\n        if (func) {\n          if (typeof func !== 'function') {\n            throw new Error(`${config.functionFieldName} must be a function`);\n          }\n          // if we have both promise and function we call that function anyway\n          func({ getState, dispatch, ...additionalData });\n        }\n        return promise({ getState, dispatch, ...additionalData }).then(\n          result => {\n            if (hooks && hooks.success) {\n              hooks.success({ ...rest, result });\n            }\n            return (types && types.success) || type\n              ? next({ ...rest, result, type: types ? types.success : action.type })\n              : null;\n          },\n          error => {\n            if (hooks && hooks.error) {\n              hooks.error({ ...rest, error });\n            }\n            return types && types.error ? next({ ...rest, error, type: types.error }) : null;\n          }\n        );\n      } else {\n        if (typeof func !== 'function') {\n          throw new Error(`${config.functionFieldName} must be a function`);\n        }\n        let result;\n        try {\n          result = func({ getState, dispatch, ...additionalData });\n          // now errors thrown in success hook and next() function will be caught as well. This is unexpected behaviour and should be changed in the future.\n          if (hooks && hooks.success) {\n            hooks.success({ ...rest, result });\n          }\n          if ((types && types.success) || type) {\n            next({...rest, result, type: types ? types.success : type});\n          }\n        } catch (error) {\n          if (hooks && hooks.error) {\n            hooks.error({ ...rest, error });\n          }\n          if (types && types.error) {\n            next({ ...rest, error, type: types.error });\n          }\n        }\n      }\n    } else {\n      next(action);\n    }\n  };\n}\n"],"names":["defaultConfig","createReduxPromiseMiddleware","additionalData","userConfig","config","_","merge","getState","dispatch","action","promiseFieldName","functionFieldName","promise","func","type","types","typesFieldName","Array","isArray","isPlainObject","typesNames","start","success","error","Error","hooks","hooksFieldName","hooksNames","rest","omit","then","result","next"],"mappings":"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"}