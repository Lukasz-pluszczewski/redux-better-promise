{"version":3,"file":"library-boilerplate.mjs","sources":["../src/index.js"],"sourcesContent":["import _ from 'lodash';\n\nconst defaultConfig = {\n  promiseFieldName: 'promise',\n  functionFieldName: 'function',\n  typesFieldName: 'types',\n  callbacksFieldName: 'callbacks',\n  typesNames: {\n    start: 'start',\n    success: 'success',\n    error: 'error',\n  },\n  callbacksNames: {\n    start: 'start',\n    success: 'success',\n    error: 'error',\n  },\n};\n\nexport default function createReduxPromiseMiddleware(additionalData, userConfig) {\n  const config = _.merge({}, defaultConfig, userConfig);\n\n  return ({ getState, dispatch }) => next => action => {\n    if (action.promise || action.function) {\n      const promise = action[config.promiseFieldName];\n\n      const func = action[config.functionFieldName];\n\n      const type = action.type;\n\n      let types;\n      if (action[config.typesFieldName]) {\n        if (Array.isArray(action[config.typesFieldName])) {\n          types = {\n            start: action[config.typesFieldName][0],\n            success: action[config.typesFieldName][1],\n            error: action[config.typesFieldName][2],\n          };\n        } else {\n          types = {\n            start: action[config.typesFieldName][config.typesNames.start],\n            success: action[config.typesFieldName][config.typesNames.success],\n            error: action[config.typesFieldName][config.typesNames.error],\n          };\n        }\n      }\n\n      let callbacks;\n      if (action[config.callbacksFieldName]) {\n        if (Array.isArray(action[config.callbacksFieldName])) {\n          callbacks = {\n            start: action[config.callbacksFieldName][0],\n            success: action[config.callbacksFieldName][1],\n            error: action[config.callbacksFieldName][2],\n          };\n        } else {\n          callbacks = {\n            start: action[config.callbacksFieldName][config.callbacksNames.start],\n            success: action[config.callbacksFieldName][config.callbacksNames.success],\n            error: action[config.callbacksFieldName][config.callbacksNames.error],\n          };\n        }\n      }\n\n      const rest = _.omit(\n        action,\n        [config.promiseFieldName, config.functionFieldName, config.typesFieldName, config.callbacksFieldName, 'type']\n      );\n\n      if (types) {\n        next({ type: types.start, ...rest });\n      }\n      if (callbacks && callbacks.start) {\n        callbacks.start(rest);\n      }\n\n      if (promise) {\n        if (func) {\n          // if we have both promise and function we call that function anyway\n          func({ getState, dispatch, ...additionalData });\n        }\n        return promise({ getState, dispatch, ...additionalData }).then(\n          result => {\n            if (callbacks && callbacks.success) {\n              callbacks.success({ ...rest, result });\n            }\n            return next({ ...rest, result, type: types ? types.success : action.type })\n          },\n          error => {\n            if (callbacks && callbacks.error) {\n              callbacks.error({ ...rest, error });\n            }\n            return types ? next({ ...rest, error, type: types.error }) : null;\n          }\n        );\n      } else {\n        let result;\n        try {\n          result = func({ getState, dispatch, ...additionalData });\n          if (callbacks && callbacks.success) {\n            callbacks.success({ ...rest, result });\n          }\n          next({ ...rest, result, type: types ? types.success : type });\n        } catch (error) {\n          if (callbacks && callbacks.error) {\n            callbacks.error({ ...rest, error });\n          }\n          if (types) {\n            next({ ...rest, error, type: types.error });\n          }\n        }\n      }\n    }\n    next(action);\n  }\n}\n"],"names":["defaultConfig","createReduxPromiseMiddleware","additionalData","userConfig","config","_","merge","getState","dispatch","action","promise","function","promiseFieldName","func","functionFieldName","type","types","typesFieldName","Array","isArray","typesNames","start","success","error","callbacks","callbacksFieldName","callbacksNames","rest","omit","then","result","next"],"mappings":"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"}